// SMURFF-like scaling based on rescale factor
@PART[*]:HAS[@MODULE[ModuleTankManager],!MODULE[ModuleCommand]]:FINAL
{
  // This is essentially what SMURFF does
  _DryMassModifier = #$@SigmaDimensions/Resize$
  @_DryMassModifier != -0.5
  @mass *= #$_DryMassModifier$
}

// SMURFF-like things for engine
@PART[*]:HAS[@MODULE[ModuleEngines*]:HAS[#maxThrust[*]]]:FINAL
{
  _ThrustModifier = #$@SigmaDimensions/Resize$
  @_ThrustModifier != 0.2
  _IspModifier = #$@SigmaDimensions/Resize$
  @_IspModifier != 0.0909090909

  @MODULE[ModuleEngines*],*
  {
    @maxThrust *= #$../_ThrustModifier$
    @atmosphereCurve
    {
      _curveFront,0 = #$key,0$
      @_curveFront,0 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$1 :
      _curveMid,0 = #$key,0$
      @_curveMid,0 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$2:
      _curveBack,0 = #$key,0$
      @_curveBack,0 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$3:
      @_curveMid,0 *= #$../../_IspModifier$
      @key,0 = #$_curveFront,0$$_curveMid,0$$_curveBack,0$
      _curveFront,1 = #$key,1$
      @_curveFront,1 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$1 :
      _curveMid,1 = #$key,1$
      @_curveMid,1 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$2:
      _curveBack,1 = #$key,1$
      @_curveBack,1 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$3:
      @_curveMid,1 *= #$../../_IspModifier$
      @key,1 = #$_curveFront,1$$_curveMid,1$$_curveBack,1$
      _curveFront,2 = #$key,2$
      @_curveFront,2 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$1 :
      _curveMid,2 = #$key,2$
      @_curveMid,2 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$2:
      _curveBack,2 = #$key,2$
      @_curveBack,2 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$3:
      @_curveMid,2 *= #$../../_IspModifier$
      @key,2 = #$_curveFront,2$$_curveMid,2$$_curveBack,2$
      _curveFront,3 = #$key,3$
      @_curveFront,3 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$1 :
      _curveMid,3 = #$key,3$
      @_curveMid,3 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$2:
      _curveBack,3 = #$key,3$
      @_curveBack,3 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$3:
      @_curveMid,3 *= #$../../_IspModifier$
      @key,3 = #$_curveFront,3$$_curveMid,3$$_curveBack,3$
      _curveFront,4 = #$key,4$
      @_curveFront,4 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$1 :
      _curveMid,4 = #$key,4$
      @_curveMid,4 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$2:
      _curveBack,4 = #$key,4$
      @_curveBack,4 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$3:
      @_curveMid,4 *= #$../../_IspModifier$
      @key,4 = #$_curveFront,4$$_curveMid,4$$_curveBack,4$
      _curveFront,5 = #$key,5$
      @_curveFront,5 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$1 :
      _curveMid,5 = #$key,5$
      @_curveMid,5 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$2:
      _curveBack,5 = #$key,5$
      @_curveBack,5 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$3:
      @_curveMid,5 *= #$../../_IspModifier$
      @key,5 = #$_curveFront,5$$_curveMid,5$$_curveBack,5$
      _curveFront,6 = #$key,6$
      @_curveFront,6 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$1 :
      _curveMid,6 = #$key,6$
      @_curveMid,6 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$2:
      _curveBack,6 = #$key,6$
      @_curveBack,6 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$3:
      @_curveMid,6 *= #$../../_IspModifier$
      @key,6 = #$_curveFront,6$$_curveMid,6$$_curveBack,6$
      _curveFront,7 = #$key,7$
      @_curveFront,7 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$1 :
      _curveMid,7 = #$key,7$
      @_curveMid,7 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$2:
      _curveBack,7 = #$key,7$
      @_curveBack,7 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$3:
      @_curveMid,7 *= #$../../_IspModifier$
      @key,7 = #$_curveFront,7$$_curveMid,7$$_curveBack,7$
      _curveFront,8 = #$key,8$
      @_curveFront,8 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$1 :
      _curveMid,8 = #$key,8$
      @_curveMid,8 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$2:
      _curveBack,8 = #$key,8$
      @_curveBack,8 ^= :^([0-9.-]+) ([0-9.-]+)(.*):$3:
      @_curveMid,8 *= #$../../_IspModifier$
      @key,8 = #$_curveFront,8$$_curveMid,8$$_curveBack,8$
      !_curveFront = dummy
      !_curveMid = dummy
      !_curveBack = dummy
    }
  }
}

@PART[*]:HAS[@MODULE[ModuleEngines*],!MODULE[ModuleCommand],!MODULE[ModuleTankManager]]:FINAL
{
  _EngineMassModifier = #$@SigmaDimensions/Resize$
  @_EngineMassModifier != -0.1
  @mass *= #$_EngineMassModifier$
}

// SMURFF-like things, for kRnD module
@PART[*]:HAS[@MODULE[KRnDModule]]:FINAL
{
  _ImprModifier = #$@SigmaDimensions/Resize$
  @_ImprModifier != 0.5
  @MODULE[KRnDModule]
  {
    @ispVac_improvement *= #$../_ImprModifier$
    @ispAtm_improvement *= #$../_ImprModifier$
  }
}
